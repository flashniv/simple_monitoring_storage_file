package ua.com.serverhelp.simplemetricstoragefile.rest.controllers.api.v1.metric;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.security.test.context.support.WithMockUser;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultHandlers;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;
import ua.com.serverhelp.simplemetricstoragefile.AbstractTest;
import ua.com.serverhelp.simplemetricstoragefile.queue.DataElement;

import java.util.List;
import java.util.Map;

@AutoConfigureMockMvc
@WithMockUser(username = "specuser", authorities = {"Metrics"})
class CollectDMetricRestTest extends AbstractTest {
    private final String[] reqs = {
            "[{\"values\":[517414912],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"free\"},{\"values\":[22351872],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_unrecl\"},{\"values\":[18018304],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_recl\"},{\"values\":[1],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"running\"},{\"values\":[59],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"sleeping\"},{\"values\":[118,118],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178846.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"stopped\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"paging\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"blocked\"},{\"values\":[1277],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"fork_rate\",\"type_instance\":\"\"},{\"values\":[2788,3670],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178846.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[200],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.943,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"curl\",\"plugin_instance\":\"example.com\",\"type\":\"response_code\",\"type_instance\":\"\"},{\"values\":[178753536],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"used\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178846.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.826,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"zombies\"},{\"values\":[0.122634839266539],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178846.943,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"curl\",\"plugin_instance\":\"example.com\",\"type\":\"response_time\",\"type_instance\":\"\"},{\"values\":[0.0166777851901268],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.814,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"user\"},{\"values\":[0.0250166777851901],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.814,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"system\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.814,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"wait\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.815,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"nice\"}]",
            "[{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.815,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"interrupt\"},{\"values\":[5008,1869],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[11,174],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.815,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"softirq\"},{\"values\":[2808,3972],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[2433536,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[102,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[5,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[254,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_merged\",\"type_instance\":\"\"},{\"values\":[48,16],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[277632000,21250048],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[4721,1831],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[11,174],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[99.9583055370247],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.815,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"idle\"},{\"values\":[2788,3670],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[2482176,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[71,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[5,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[44,12],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_io_time\",\"type_instance\":\"\"}]",
            "[{\"values\":[284886528,21250048],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[118,118],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[228729,228729],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_errors\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[1881,1658],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[2787,879],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_merged\",\"type_instance\":\"\"},{\"values\":[203264,985940],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_errors\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[2533,879],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_merged\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.815,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"steal\"},{\"values\":[4815511552],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"free\"},{\"values\":[476733440],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"reserved\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_errors\",\"type_instance\":\"\"},{\"values\":[532963328],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"free\"},{\"values\":[3612672],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"used\"}]",
            "[{\"values\":[4],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"users\",\"plugin_instance\":\"\",\"type\":\"users\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"used\"},{\"values\":[999288832],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"free\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"cached\"},{\"values\":[178753536],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"used\"},{\"values\":[0,0,0],\"dstypes\":[\"gauge\",\"gauge\",\"gauge\"],\"dsnames\":[\"shortterm\",\"midterm\",\"longterm\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"load\",\"plugin_instance\":\"\",\"type\":\"load\",\"type_instance\":\"\"},{\"values\":[268390400],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"cached\"},{\"values\":[517414912],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"free\"},{\"values\":[22351872],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_unrecl\"},{\"values\":[18018304],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_recl\"},{\"values\":[0],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap_io\",\"type_instance\":\"in\"},{\"values\":[0],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap_io\",\"type_instance\":\"out\"},{\"values\":[1],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"running\"},{\"values\":[59],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"sleeping\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"zombies\"},{\"values\":[3657523200],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"used\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"paging\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"blocked\"},{\"values\":[1277],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"fork_rate\",\"type_instance\":\"\"},{\"values\":[0.129835370928049],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.950,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"curl\",\"plugin_instance\":\"example.com\",\"type\":\"response_time\",\"type_instance\":\"\"}]",
            "[{\"values\":[200],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.950,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"curl\",\"plugin_instance\":\"example.com\",\"type\":\"response_code\",\"type_instance\":\"\"},{\"values\":[16715776],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"buffered\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"reserved\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178876.824,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"processes\",\"plugin_instance\":\"\",\"type\":\"ps_state\",\"type_instance\":\"stopped\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178876.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[0.0083395880243516],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.812,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"user\"},{\"values\":[0.0083395880243516],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.812,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"system\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.812,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"wait\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.812,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"nice\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.812,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"interrupt\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.813,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"softirq\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.813,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"steal\"},{\"values\":[99.9833208239513],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.813,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"cpu\",\"plugin_instance\":\"\",\"type\":\"percent\",\"type_instance\":\"idle\"},{\"values\":[4815511552],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"free\"},{\"values\":[3657523200],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"used\"},{\"values\":[532963328],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"free\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"reserved\"},{\"values\":[476733440],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"root\",\"type\":\"df_complex\",\"type_instance\":\"reserved\"},{\"values\":[3612672],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"df\",\"plugin_instance\":\"boot-efi\",\"type\":\"df_complex\",\"type_instance\":\"used\"},{\"values\":[284886528,21250048],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_octets\",\"type_instance\":\"\"}]",
            "[{\"values\":[5008,1869],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[102,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[5,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[254,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_merged\",\"type_instance\":\"\"},{\"values\":[2808,3972],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[277632000,21250048],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[4721,1831],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_ops\",\"type_instance\":\"\"},{\"values\":[11,174],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[2533,879],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_merged\",\"type_instance\":\"\"},{\"values\":[2788,3670],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda2\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[2482176,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[11,174],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[5,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_time\",\"type_instance\":\"\"},{\"values\":[44,12],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"io_time\",\"weighted_io_time\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda3\",\"type\":\"disk_io_time\",\"type_instance\":\"\"},{\"values\":[0,0,0],\"dstypes\":[\"gauge\",\"gauge\",\"gauge\"],\"dsnames\":[\"shortterm\",\"midterm\",\"longterm\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"load\",\"plugin_instance\":\"\",\"type\":\"load\",\"type_instance\":\"\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"used\"},{\"values\":[999288832],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"free\"},{\"values\":[0],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap\",\"type_instance\":\"cached\"},{\"values\":[178786304],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"used\"}]",
            "[{\"values\":[16715776],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"buffered\"},{\"values\":[268390400],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"cached\"},{\"values\":[517382144],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"free\"},{\"values\":[22351872],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_unrecl\"},{\"values\":[18018304],\"dstypes\":[\"gauge\"],\"dsnames\":[\"value\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"memory\",\"plugin_instance\":\"\",\"type\":\"memory\",\"type_instance\":\"slab_recl\"},{\"values\":[0],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap_io\",\"type_instance\":\"in\"},{\"values\":[0],\"dstypes\":[\"derive\"],\"dsnames\":[\"value\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"swap\",\"plugin_instance\":\"\",\"type\":\"swap_io\",\"type_instance\":\"out\"},{\"values\":[118,118],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[228729,228729],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_errors\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"lo\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[1898,1674],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[207297,1000119],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_errors\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"enp0s6\",\"type\":\"if_dropped\",\"type_instance\":\"\"},{\"values\":[2433536,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"read\",\"write\"],\"time\":1657178906.819,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"disk\",\"plugin_instance\":\"vda1\",\"type\":\"disk_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_packets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_octets\",\"type_instance\":\"\"},{\"values\":[0,0],\"dstypes\":[\"derive\",\"derive\"],\"dsnames\":[\"rx\",\"tx\"],\"time\":1657178906.820,\"interval\":30.000,\"host\":\"debian\",\"plugin\":\"interface\",\"plugin_instance\":\"docker0\",\"type\":\"if_dropped\",\"type_instance\":\"\"}]"
    };
    @Autowired
    private MockMvc mockMvc;

    @Test
    void receiveData() throws Exception {
        for (String req : reqs) {

            mockMvc.perform(MockMvcRequestBuilders.post("/apiv1/metric/collectd/")
                                    .header("X-Project", "testproj")
                                    .content(req)
                            //.contentType(MediaType.ALL_VALUE)
                    )
                    .andDo(MockMvcResultHandlers.print())
                    .andExpect(MockMvcResultMatchers.status().is(200))
                    .andExpect(MockMvcResultMatchers.content().string("Success"));
        }

        Map<String, List<DataElement>> map = memoryMetricsQueue.getFormattedEvents();
        Assertions.assertEquals(100, map.size());

        List<DataElement> dataElements = map.get("collectd.testproj.debian.memory{\"ds_name\":\"value\",\"type_instance\":\"slab_unrecl\",\"ds_type\":\"gauge\",\"type\":\"memory\"}");
        Assertions.assertNotNull(dataElements);
        Assertions.assertEquals(3, dataElements.size());

        DataElement dataElement = dataElements.get(0);
        Assertions.assertEquals(2.2351872E7, dataElement.getValue());

    }
}